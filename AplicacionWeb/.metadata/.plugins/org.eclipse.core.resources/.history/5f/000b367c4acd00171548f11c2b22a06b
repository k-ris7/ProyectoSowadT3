package com.capadatos.agenda;
import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;

import com.capaentidades.agenda.Usuario;

public class UsuarioDatos {

	// Singleton
		public static UsuarioDatos _Instancia;

		private UsuarioDatos() {
		};

		public static UsuarioDatos Instancia() {
			if (_Instancia == null) {
				_Instancia = new UsuarioDatos();
			}
			return _Instancia;
		}
		// endSingleton
		
		public Usuario VerificarAcceso(String _Usuario, String _Pass) throws Exception {
			Connection cn = null;
			Usuario u = null;
			try {
				cn = Conexion.Instancia().Conectar();
				CallableStatement cst = cn.prepareCall("{call sp_VerificaUsuario(?,?)}");
				cst.setString(1, _Usuario);
				cst.setString(2, _Pass);
				ResultSet rs = cst.executeQuery();
				if (rs.next()) {
					u = new Usuario();
					u.setID(rs.getInt("ID"));
					u.setUsuario(rs.getString("usuario"));
					u.setPassword(rs.getString("password"));
					u.setNombre(rs.getString("Nombre"));
				}
				return u;
			} catch (Exception e) {
				throw e;
			} finally {
				cn.close();
			}
		}
		
		public boolean InsertarUsuario(Usuario c) throws Exception {
			Connection cn = null;
			boolean inserto = false;
			try {
				cn = Conexion.Instancia().Conectar();
				CallableStatement cst = cn.prepareCall("{call sp_InsertaUsuario(?,?,?)}");
				cst.setString(1, c.getUsuario());
				cst.setString(2, c.getPassword());
				cst.setString(3, c.getNombre());
				
				int i = cst.executeUpdate();
				if(i>0){inserto=true;}			
			} catch (Exception e) {
				throw e;
			} finally {
				cn.close();
			}
			return inserto;
		}
		
		
}
